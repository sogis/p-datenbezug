
@startuml

!include <tupadr3/common>
!define ICONURL https://raw.githubusercontent.com/Roemer/plantuml-office/master/office2014
!includeurl ICONURL/Concepts/document.puml
!includeurl ICONURL/Concepts/documents.puml


package "Datenquellen"{
    database "GeoDB" {
        [ili2pg - Schema] as db
    }
    folder "INTERLIS Daten" {
        OFF_DOCUMENT(tf, "*.xtf, *.itf")
    }
}

package "SIMI"{
    
    component "SIMI" as simi {
      [metaBean2File]
    }
    () papi as "Für Publisher"
    simi - papi
    
    database "Meta-DB" as mdb {
        [Tables / Views] as mtrel
    }
    
    simi --> mdb
}

package "Pipeline (oder Gradle)" as dag {

    component "Meta-Exporter" as mex {
      [metaBean2File ]
    }
}
note left of dag
  Anforderungen:
  - Portale
    - sftp upload mit pki
    - Konf-Dateien in Datensuche-Image brennen
  - Datensuche
    - Konf-Dateien in Image brennen
    - Image deployen
  - (lokal auf Terminal ausführbar)
end note

[GDI WMTS] as wmts

package "Links" as link {
    [GDI WMS] as wms
    [GDI WGC] as wgc
    [geodienste] as ai
}


package "Datenbezug"{

		package "Portale (opendata, geocat)" {
			OFF_DOCUMENTS(gm03, ThemePubs (*.xtf))
			[geocat] as gc
			[opendata.swiss] as od
		}

    package "Publisher (GRETL)" {
        [Publisher] as pub
    }
    
    package "Datenablage"{
        OFF_DOCUMENTS(data, Daten-Dateien)
    }
    
    package "Datensuche" {
        [Datensuche] as ds
        OFF_DOCUMENTS(bconf, Konf-Dateien (*.*))
    }
    
    pub --> data : sftp (schreibend)
    ds --> data : https
    note on link
      - Daten-Zips
      - detailbeschreibung.html
    end note
}

package "Generische Clients"{
    [Browser] as httpc
    [FTP-Client] as ftpc
    
    httpc -[hidden]-> ftpc
}

package "Datenadministration"{
    [FTP-Client] as ftpadmin
}

pub -up-> db : db con
pub -up-> tf : filesys read
pub -up-> papi : OAuth2

httpc --> data : https
ftpc  -left-> data : ftp (lesend)
ftpadmin  -up-> data : sftp (schreibend)


note on link
  regions.json ist ein keyval json.
  -key: region layer identifier
  -val: layer als geojson
end note

mex -up-> mtrel
mex --> gm03
mex --> bconf

od --> ds
gc --> ds

ds ---> wmts : Hintergrundkarte
ds ---> link : Themen-Links

@enduml