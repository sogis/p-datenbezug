@startuml

!include <tupadr3/common>
!define ICONURL https://raw.githubusercontent.com/Roemer/plantuml-office/master/office2014
!includeurl ICONURL/Concepts/document.puml
!includeurl ICONURL/Concepts/documents.puml


package "Datenquellen"{
    database "GeoDB" {
        [ili2pg - Schema] as db
    }
    folder "INTERLIS Daten" {
        OFF_DOCUMENT(tf, "*.xtf, *.itf")
    }
}

package "SIMI"{
    
    [SIMI] as simi
    () rest as "HTTPS GET / PUT"
    rest - simi
    
    database "Meta-DB" {
        [Meta-Tables] as mdb
    }
    
    package "Pipeline" as pipe {
        [sql2json] as sj
    }
    
    sj -up-> mdb
    simi --> mdb
}

[GDI WMTS] as wmts

package "Links" as link {
    [GDI WMS] as wms
    [GDI WGC] as wgc
    [geodienste] as ai
}


package "Datenbezug"{
    package "Publisher (GRETL)" {
        [Publisher] as pub
    }
    
    package "Datenablage"{
        OFF_DOCUMENTS(data, Daten-Dateien)
    }
    
    package "Datensuche" {
        [Datensuche] as ds
        OFF_DOCUMENT(bconf, config.yaml)
        OFF_DOCUMENTS(regions, [regions].geojson)
    }
    
    pub --> data : sftp (schreibend)
    ds --> data : https
}

package "Generische Clients"{
    [Browser] as httpc
    [FTP-Client] as ftpc
    
    httpc -[hidden]-> ftpc
}

package "Datenadministration"{
    [FTP-Client] as ftpadmin
}

pub -up-> db : db con
pub -up-> tf : filesys read
pub -up-> rest : OAuth2

httpc --> data : https
ftpc  -left-> data : ftp (lesend)
ftpadmin  -up-> data : sftp (schreibend)

pipe --> bconf : filesys write
pipe --> regions : filesys write

ds ---> wmts : Hintergrundkarte
ds ---> link : Themen-Links

@enduml